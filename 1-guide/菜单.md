# 菜单系统逻辑说明

## 概述

本项目的菜单系统采用配置驱动的方式，通过集中配置菜单项，自动渲染和匹配路由。

## 核心文件

- **菜单配置**: `src/components/layouts/main/sider/sidebarNavigation.tsx`
- **菜单渲染**: `src/components/layouts/main/sider/SiderMenu/SiderMenu.tsx`
- **路由配置**: `src/components/router/AppRouter.tsx`
- **主布局**: `src/components/layouts/main/MainLayout/MainLayout.tsx`

## 菜单配置结构

菜单配置定义在 `sidebarNavigation.tsx` 中，使用 `SidebarNavigationItem` 接口：

```typescript
export interface SidebarNavigationItem {
  title: string;        // 国际化键名，如 'common.nft-dashboard'
  key: string;          // 唯一标识符
  url?: string;         // 路由路径（可选）
  children?: SidebarNavigationItem[];  // 子菜单项（可选）
  icon?: React.ReactNode;  // 图标组件（可选）
}
```

### 配置示例

```typescript
export const sidebarNavigation: SidebarNavigationItem[] = [
  {
    title: 'common.nft-dashboard',
    key: 'nft-dashboard',
    url: '/',
    icon: <NftIcon />,
  },
  {
    title: 'common.apps',
    key: 'apps',
    icon: <HomeOutlined />,
    children: [
      {
        title: 'common.feed',
        key: 'feed',
        url: '/apps/feed',
      },
    ],
  },
];
```

## 菜单渲染逻辑

### 1. 自动高亮选中项

`SiderMenu` 组件会根据当前路由路径自动选中对应的菜单项：

```typescript
// 将嵌套菜单结构扁平化
const sidebarNavFlat = sidebarNavigation.reduce(
  (result: SidebarNavigationItem[], current) =>
    result.concat(current.children && current.children.length > 0 ? current.children : current),
  [],
);

// 根据当前路径找到对应的菜单项
const currentMenuItem = sidebarNavFlat.find(({ url }) => url === location.pathname);
const defaultSelectedKeys = currentMenuItem ? [currentMenuItem.key] : [];
```

### 2. 自动展开父级菜单

如果当前路径在某个子菜单中，会自动展开该父级菜单：

```typescript
const openedSubmenu = sidebarNavigation.find(({ children }) =>
  children?.some(({ url }) => url === location.pathname),
);
const defaultOpenKeys = openedSubmenu ? [openedSubmenu.key] : [];
```

### 3. 菜单项转换

将配置转换为 Ant Design Menu 组件所需的格式：

- **有子菜单的项**: 父项不设置链接，只显示标题
- **无子菜单的项**: 父项使用 `Link` 组件进行路由跳转
- **子菜单项**: 所有子项都使用 `Link` 组件

```typescript
items={sidebarNavigation.map((nav) => {
  const isSubMenu = nav.children?.length;
  
  return {
    key: nav.key,
    title: t(nav.title),  // 使用国际化翻译
    label: isSubMenu ? t(nav.title) : <Link to={nav.url || ''}>{t(nav.title)}</Link>,
    icon: nav.icon,
    children: isSubMenu && nav.children && nav.children.map((childNav) => ({
      key: childNav.key,
      label: <Link to={childNav.url || ''}>{t(childNav.title)}</Link>,
      title: t(childNav.title),
    })),
  };
})}
```

## 组件层级关系

```
MainLayout (主布局)
  └── MainSider (侧边栏容器)
      ├── SiderLogo (Logo 组件)
      └── SiderMenu (菜单组件)
          └── 使用 sidebarNavigation 配置渲染菜单
```

## 路由匹配

菜单的 `url` 字段必须与 `AppRouter.tsx` 中定义的路由路径保持一致：

- 菜单配置: `url: '/apps/feed'`
- 路由配置: `<Route path="apps/feed" element={<NewsFeed />} />`

## 交互行为

1. **点击菜单项**: 通过 React Router 的 `Link` 组件进行路由跳转
2. **移动端自动收起**: 点击菜单项后，在移动端会自动收起侧边栏 (`onClick={() => setCollapsed(true)}`)
3. **响应式适配**: 根据屏幕尺寸自动调整侧边栏的显示方式

## 国际化支持

所有菜单标题都使用国际化键名（如 `'common.nft-dashboard'`），通过 `useTranslation` hook 的 `t()` 方法进行翻译。

## 如何修改菜单

### 添加新菜单项

在 `sidebarNavigation.tsx` 的配置数组中添加新项：

```typescript
{
  title: 'common.new-menu',
  key: 'new-menu',
  url: '/new-menu',
  icon: <NewIcon />,
}
```

### 添加子菜单

在父菜单项中添加 `children` 数组：

```typescript
{
  title: 'common.parent-menu',
  key: 'parent-menu',
  icon: <ParentIcon />,
  children: [
    {
      title: 'common.child-menu',
      key: 'child-menu',
      url: '/parent/child',
    },
  ],
}
```

### 添加对应路由

在 `AppRouter.tsx` 中添加对应的路由配置：

```typescript
<Route path="new-menu" element={<NewMenuPage />} />
```

## 注意事项

1. **菜单 key 必须唯一**: 每个菜单项的 `key` 值在整个配置中必须唯一
2. **url 与路由匹配**: 菜单的 `url` 必须与路由配置中的路径一致
3. **国际化键名**: `title` 字段使用国际化键名，需要在 `locales` 目录下的语言文件中定义对应的翻译
4. **图标组件**: `icon` 字段需要传入 React 组件，可以使用 Ant Design 图标或自定义 SVG 图标


